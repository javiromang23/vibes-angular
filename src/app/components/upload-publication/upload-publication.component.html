<app-navbar></app-navbar>
<div class="container-fluid p-0">
    <main class="container d-flex justify-content-center align-items-center vh-75">
        <div class="card w-75 overflow-hidden publication flex-column m-3 card-sm-publication" *ngIf="user">
            <div class="card-header bg-white d-flex flex-fill border-bottom-0">
                <div class="image-wrapper">
                    <div class="image-profile rounded-circle">
                        <a [routerLink]="['/u/' + user.username]"><img
                                [src]="url + 'user/' + user.username + '/' + user.avatar"
                                alt="perfil" /></a>
                    </div>
                </div>
                <div class="d-flex justify-content-center align-items-center" *ngIf="user.username">
                    <a [routerLink]="['/u/' + user.username]">{{user.username}}</a>
                </div>
                <div class="small bold d-flex justify-content-end align-items-center flex-fill text-right date-publication">
                    <button class="btn btn-primary btn-custom pl-3 pr-3" [disabled]="!formPublication.valid" (click)="uploadPublication(image)">Publicar</button>
                </div>
            </div>
            <div class="card-body p-0 d-flex flex-wrap">
                <div class="image image-upload-p image-left border-top image-upload d-flex justify-content-center align-items-center">
                    <div class="logo-image" *ngIf="!imagePreview">
                        <i class="fa fa-image"></i>
                    </div>
                    <img [src]="imagePreview" alt="{{publication.title}}" *ngIf="imagePreview">
                </div>
                <div class="card-footer footer-right bg-white p-0 position-relative border-left">
                    <div class="panel-action comments-box p-1 pb-3 pt-3 d-flex">
                        <div class="col-md-12">
                            <div class="col-md-12 pl-0">
                                <b class="bold pl-0 pr-1">{{user.username}}</b> {{publication.description}}
                            </div>
                        </div>
                    </div>
                    <div class="box-bottom position-absolute w-100">
                        <form #formPublication="ngForm">
                            <div class="panel-action pl-3 pb-0 pr-3 d-flex flex-wrap justify-content-center align-items-center">
                                <div class="form-group d-flex flex-column w-100">
                                    <input type="file" id="image" name="image" #image class="form-control-file d-none" 
                                    (change)="readImagePreview(image)" required>
                                    <div class="upload-file d-flex justify-content-center align-items-center">
                                        <i class="fa fa-upload" (click)="image.click()"></i>
                                        <button class="btn" (click)="image.click()"> Subir imagen</button>
                                    </div>
                                    <div class="d-flex justify-content-center align-items-center pt-2">
                                        <select name="category" #category="ngModel" [(ngModel)]="publication.category" id="category" class="form-control" required>
                                            <option value="unspecified">Sin especificar</option>
                                            <option *ngFor="let category of categories" value="{{category}}">{{category}}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="border-top d-flex">
                                <textarea name="description" id="commentBox" #commentBox="ngModel"
                                    class="form-control border-0 comment flex-row comment-publication w-100" cols="5" rows="2"
                                    placeholder="Agrega una descripción..." [(ngModel)]="publication.description" required>
                                </textarea>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="card-footer w-100 bg-white border-top-0 p-0 d-flex flex-wrap flex-column d-sm-none d-md-none">
                    <div class="panel-action pl-3 pb-0 pr-3 d-flex justify-content-left align-items-center">
                        <div class="col-md-12 p-0 pt-3">
                            <div class="col-md-12 pl-0">
                                <b class="bold pl-0 pr-1">{{user.username}}</b> {{publication.description}}
                            </div>
                        </div>
                    </div>
                    <div class="w-100">
                        <form #formPublication="ngForm">
                            <div class="panel-action p-0 pt-5">
                                <div class="form-group d-flex flex-row w-100 justify-content-center align-items-center">
                                    <input type="file" id="image" name="image" #image class="form-control-file d-none"
                                        (change)="readImagePreview(image)" required>
                                    <div class="upload-file d-flex justify-content-center align-items-center">
                                        <i class="fa fa-upload" (click)="image.click()"></i>
                                        <button class="btn" (click)="image.click()"> Subir imagen</button>
                                    </div>
                                    <div class="d-flex justify-content-center align-items-center pl-2">
                                        <select name="category" #category="ngModel" [(ngModel)]="publication.category" id="category"
                                            class="form-control" required>
                                            <option value="unspecified">Sin especificar</option>
                                            <option *ngFor="let category of categories" value="{{category}}">{{category}}</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="border-top d-flex">
                                <textarea name="description" id="commentBox" #commentBox="ngModel"
                                    class="form-control border-0 comment flex-row comment-publication w-100" cols="5" rows="2"
                                    placeholder="Agrega una descripción..." [(ngModel)]="publication.description" required>
                                </textarea>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>